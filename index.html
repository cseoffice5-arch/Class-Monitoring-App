<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Class Monitoring App</title>

  <!-- ================= PWA ================= -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0A7E4A">

  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="DIU Class Monitor">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <!-- ================= STYLES ================= -->
  <link rel="stylesheet" href="style.css">

  <!-- ================= GOOGLE LOGIN ================= -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>

<!-- ================= LOGIN GATE ================= -->
<div id="loginBox">
  <h2>Sign in to continue</h2>
  <button type="button" onclick="googleLogin()">Sign in with Google</button>
</div>

<div id="app" style="display:none;">
  APP LOADED
</div>

<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="script.js"></script>

<!-- ================= APP ================= -->
<div id="app" style="display:none;">

  <!-- ================= DASHBOARD ================= -->
  <div class="dashboard">
    <div class="card total-missed">
      Total Missed
      <span id="totalMissed">0</span>
    </div>

    <div class="card">
      Makeup Completed
      <span id="completed">0</span>
    </div>

    <div class="card">
      Makeup Pending
      <span id="pending">0</span>
    </div>

    <div class="card">
      Extra Classes
      <span id="extraCount">0</span>
    </div>
  </div>

  <!-- ================= HEADER ================= -->
  <header>
    <h1>Class Monitoring App</h1>
    <p class="subtitle">Missed & Makeup Class Entry — CSE-DIU</p>

    <div class="logo-wrap">
      <img src="icon-512.svg" alt="App Logo" class="app-logo">
    </div>
  </header>

  <!-- ================= MAIN ================= -->
  <main class="container">

    <!-- Controls -->
    <div class="controls">
      <button id="btn-missed">Missed Class Entry</button>
      <button id="btn-makeup">Makeup Class Entry</button>
      <button id="btn_pending">Pending Makeup</button>
    </div>

    <!-- ================= MISSED CLASS ================= -->
    <form id="missedForm" class="form hidden" autocomplete="off">
      <h2>Missed Class Entry</h2>

      <div class="grid">
        <label>Date
          <input type="date" id="m_date" required>
        </label>

        <label>Department
          <input type="text" id="m_dept_filter" class="filter">
          <select id="m_dept" required></select>
        </label>
      </div>

      <div class="grid">
        <label>Course
          <input type="text" id="m_course_filter" class="filter">
          <select id="m_course" size="6" required></select>
        </label>

        <label>Room
          <input type="text" id="m_room_filter" class="filter">
          <select id="m_room" size="6"></select>
        </label>
      </div>

      <div class="grid">
        <label>Time Slot
          <input type="text" id="m_time_filter" class="filter">
          <select id="m_time" size="6"></select>
        </label>

        <label>Teacher
          <input type="text" id="m_teacher_filter" class="filter">
          <select id="m_teacher" size="6" required></select>
        </label>
      </div>

      <label>Reason
        <select id="m_reason" required>
          <option value="">Select reason</option>
          <option>Leave</option>
          <option>Sick</option>
          <option>Student Absent</option>
          <option>Absent</option>
          <option>Both are Absent</option>
          <option>Due to an Emergency</option>
        </select>
      </label>

      <button type="submit" class="submit">Submit Missed Class</button>
    </form>

    <!-- ================= MAKEUP CLASS ================= -->
    <form id="makeupForm" class="form hidden" autocomplete="off">
      <h2>Makeup Class Entry</h2>

      <div class="grid">
        <label>Schedule Date
          <input type="date" id="k_schedule" required>
        </label>

        <label>Department
          <input type="text" id="k_dept_filter" class="filter">
          <select id="k_dept" required></select>
        </label>
      </div>

      <div class="grid">
        <label>Course
          <input type="text" id="k_course_filter" class="filter">
          <select id="k_course" size="6" required></select>
        </label>

        <label>Teacher
          <input type="text" id="k_teacher_filter" class="filter">
          <select id="k_teacher" size="6" required></select>
        </label>
      </div>

      <div class="grid">
        <label>Makeup Date
          <input type="date" id="k_date" required>
        </label>

        <label>Makeup Time
          <input type="text" id="k_time_filter" class="filter">
          <select id="k_time" size="6" required></select>
        </label>
      </div>

      <div class="grid">
        <label>Room
          <input type="text" id="k_room_filter" class="filter">
          <select id="k_room" size="6" required></select>
        </label>

        <label>Status
          <select id="k_status">
            <option>Pending</option>
            <option>Completed</option>
          </select>
        </label>
      </div>

      <label>Remarks
        <input type="text" id="k_remarks">
      </label>

      <button type="submit" class="submit">Save Makeup Class</button>
    </form>

    <!-- ================= PENDING ================= -->
    <div id="pendingSection" class="form hidden">
      <h2>Pending Makeup Classes</h2>

      <input type="text" id="pendingTeacherSearch" class="filter"
             placeholder="Search by Teacher...">

      <div class="table-wrap">
        <table id="pendingTable">
          <thead>
            <tr>
              <th>Schedule</th>
              <th>Dept</th>
              <th>Course</th>
              <th>Teacher</th>
              <th>Date</th>
              <th>Time</th>
              <th>Room</th>
              <th>Status</th>
              <th>Remarks</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

  </main>

  <!-- ================= FOOTER ================= -->
  <footer>
    <small>
      Built for Daffodil International University — Md. Sarower Mal (CSE)
    </small>
  </footer>

</div>

<!-- ================= SCRIPTS ================= -->
<script src="script.js"></script>

<script>
/* UI toggle */
const missedForm = document.getElementById("missedForm");
const makeupForm = document.getElementById("makeupForm");
const pendingSection = document.getElementById("pendingSection");

btn-missed.onclick = () => {
  missedForm.classList.remove("hidden");
  makeupForm.classList.add("hidden");
  pendingSection.classList.add("hidden");
};

btn-makeup.onclick = () => {
  makeupForm.classList.remove("hidden");
  missedForm.classList.add("hidden");
  pendingSection.classList.add("hidden");
};

btn_pending.onclick = () => {
  pendingSection.classList.remove("hidden");
  missedForm.classList.add("hidden");
  makeupForm.classList.add("hidden");
  loadPendingMakeup();
};
</script>

<script>
/* Google Login */
let userEmail = "";

function googleLogin() {
  if (!window.google || !google.accounts) {
    alert("Google service loading... try again");
    return;
  }

  google.accounts.id.initialize({
    client_id: "YOUR_CLIENT_ID.apps.googleusercontent.com",
    callback: res => {
      const payload = JSON.parse(atob(res.credential.split(".")[1]));
      userEmail = payload.email;

      document.getElementById("loginBox").style.display = "none";
      document.getElementById("app").style.display = "block";
    }
  });

  google.accounts.id.prompt();
}
</script>

<script>
/* Service Worker */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
